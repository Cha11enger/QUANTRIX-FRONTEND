script:post-response {
  // Post-response script for Get Role Permissions API
  // Updates environment with role permissions results
  
  console.log('=== Get Role Permissions Post-Response Script ===');
  console.log('Response Status:', res.status);
  
  try {
    if (res.status === 200) {
      const responseBody = res.getBody();
      console.log('Role permissions retrieved successfully');
      
      if (responseBody && responseBody.success && responseBody.data) {
        const permissions = responseBody.data;
        
        // Store role permissions
        if (permissions && Array.isArray(permissions)) {
          bru.setEnvVar('actualuser.rolePermissions', JSON.stringify(permissions), {persist: true});
          
          // Store the role ID that was requested
          const requestedRoleId = bru.getVar('roleId') || bru.getEnvVar('roleId');
          if (requestedRoleId) {
            bru.setEnvVar('actualuser.lastRoleIdRequested', requestedRoleId, {persist: true});
          }
          
          console.log('✅ Role permissions stored in environment:');
          console.log('- Role ID:', requestedRoleId);
          console.log('- Permissions Count:', permissions.length);
        }
        
      } else {
        console.warn('Warning: Unexpected response structure for successful role permissions request');
      }
      
    } else if (res.status === 401) {
      console.error('❌ Authentication failed - Token invalid or expired');
      
      // Preserve tokens for debugging; record the auth error instead
      bru.setEnvVar('actualuser.lastAuthError', '401: invalid or expired token', {persist: true});
      console.log('Preserving tokens. Recorded lastAuthError for troubleshooting.');
      
    } else if (res.status === 403) {
      console.error('❌ Access forbidden - Token valid but insufficient permissions');
      
    } else if (res.status === 404) {
      console.error('❌ Role not found - Role may not exist');
      
    } else if (res.status === 429) {
      console.error('❌ Rate limit exceeded - Too many role permissions requests');
      
    } else if (res.status >= 500) {
      console.error('❌ Server error occurred while fetching role permissions');
      
    } else {
      console.error('❌ Unexpected response status:', res.status);
    }
    
  } catch (error) {
    console.error('❌ Error processing role permissions response:', error.message);
  }
  
  console.log('Post-response processing completed.');
}